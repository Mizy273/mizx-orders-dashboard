<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Orders Dashboard</title>
  <style>
    body {
      font-family: Arial;
      background:#0b1020;
      color:white;
      text-align:center;
      padding:30px;
    }
    input, select, button {
      padding:10px;
      margin:6px;
      border-radius:8px;
      border:none;
      width:250px;
    }
    button {
      cursor:pointer;
      background:#8b5cf6;
      color:white;
      font-weight:bold;
    }
    table {
      margin:auto;
      margin-top:30px;
      border-collapse:collapse;
      width:80%;
    }
    td, th {
      border:1px solid #333;
      padding:10px;
    }
    .danger {
      background:red;
      padding:6px 12px;
      border-radius:6px;
      cursor:pointer;
    }
  </style>
</head>
<body>

<h1>Admin Orders Dashboard</h1>

<h2>Login Admin</h2>
<input id="email" placeholder="Admin Email" value="iamtarmizikadir@gmail.com"><br>
<input id="password" placeholder="Password" type="password"><br>
<button onclick="login()">Login</button>

<hr><br>

<h2>Add Order</h2>

<input id="orderId" placeholder="Order ID (cth: 12345)"><br>
<input id="pack" placeholder="Pack (Tray Box)"><br>
<input id="product" placeholder="Product"><br>
<input id="qty" placeholder="Qty" type="number"><br>
<input id="due" type="date"><br>

<select id="status">
  <option value="IN_PRINT">IN_PRINT</option>
  <option value="READY">READY</option>
  <option value="PACKED">PACKED</option>
  <option value="DONE">DONE</option>
</select><br>

<button onclick="addOrder()">Add / Update Order</button>

<h2>Orders List</h2>
<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Product</th>
      <th>Qty</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="ordersTable"></tbody>
</table>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

  import {
    getFirestore,
    doc,
    setDoc,
    deleteDoc,
    collection,
    getDocs
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  import {
    getAuth,
    signInWithEmailAndPassword,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBcTwfcZRKs-9z-NyBmwOPaXRAnQM_nh8o",
    authDomain: "mizxart-orders.firebaseapp.com",
    projectId: "mizxart-orders",
    storageBucket: "mizxart-orders.firebasestorage.app",
    messagingSenderId: "1078338622603",
    appId: "1:1078338622603:web:80a38dc732637aaebcb08e"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // ✅ LOGIN
  window.login = async function () {
    let email = document.getElementById("email").value;
    let password = document.getElementById("password").value;

    try {
      await signInWithEmailAndPassword(auth, email, password);
      alert("Login success!");
    } catch (err) {
      alert("Login failed: " + err.message);
    }
  };

  // ✅ ADD ORDER (DocID = OrderID)
  window.addOrder = async function () {
    let id = document.getElementById("orderId").value.trim();
    let pack = document.getElementById("pack").value.trim();
    let product = document.getElementById("product").value.trim();
    let qty = Number(document.getElementById("qty").value);
    let due = document.getElementById("due").value;
    let status = document.getElementById("status").value;

    if (!id) return alert("Order ID wajib isi!");

    try {
      await setDoc(doc(db, "orders", id), {
        id,
        pack,
        product,
        qty,
        due,
        status
      });

      alert("Order saved! DocID = " + id);
      loadOrders();
    } catch (err) {
      alert("Add error: " + err.message);
    }
  };

  // ✅ DELETE ORDER
  window.deleteOrder = async function (id) {
    if (!confirm("Delete order " + id + "?")) return;

    try {
      await deleteDoc(doc(db, "orders", id));
      alert("Deleted!");
      loadOrders();
    } catch (err) {
      alert("Delete error: " + err.message);
    }
  };

  // ✅ LOAD ORDERS
  async function loadOrders() {
    const snap = await getDocs(collection(db, "orders"));
    let html = "";

    snap.forEach(docu => {
      let o = docu.data();
      html += `
        <tr>
          <td>${o.id}</td>
          <td>${o.product}</td>
          <td>${o.qty}</td>
          <td>${o.status}</td>
          <td><span class="danger" onclick="deleteOrder('${o.id}')">Delete</span></td>
        </tr>
      `;
    });

    document.getElementById("ordersTable").innerHTML = html;
  }

  // Auto refresh bila login
  onAuthStateChanged(auth, user => {
    if (user) loadOrders();
  });

</script>
</body>
</html>
